* Deploy cluster via Minikube/KinD
** Minikube
#+begin_src shell
# Start cluster and enable ingress add-on
minikube start
minikube addons enable ingress

# Stop the cluster
minikube stop
#+end_src

** KinD
The =kind-config.yaml.TEMPLATE= is a template for generating =kind-config.yaml= with =go-task kind:01-generate-config= command which uses 2 extra mounts that the kind cluster is going to mount in to each node for persisting data.
#+begin_src shell
# View task commands
go-task --list-all

# Start cluster with 2 worker nodes
go-task kind:01-generate-config        # it is going to create one container for control-plane and two containers for worker-nodes
go-task kind:02-create-cluster

# Verify
kubectl get nodes

# The cloud-provider-kind tool enables to run load-balancers within the kind cluster so we'll be able to access it from the host
# when we'll deploy a service with kind: LoadBalancer, install it when you want to deploy LoadBalancer services
#go-task kind:03-run-cloud-provider-kind  

# Delete the cluster
go-task kind:04-delete-cluster
#+end_src

** Apply manifests
*** Using kubectl
#+begin_src shell
# Navigate to Taskfile.yaml directory
cd k8s/deploy
go-task --list-all

# Render production env
go-task render-production

# Apply production env (default namespace)
go-task deploy-production

# To delete production env
go-task delete-production
#+end_src

*** Using helm
#+begin_src shell
# Navigate to Taskfile.yaml directory
cd k8s/helm
go-task --list-all

# Render production env
go-task render-template-production

# Install production env (default namespace)
go-task install-template-production

# List realeases
helm list -A

# Uninstall production env
go-task uninstall-template-production
#+end_src

** Test health endpoint
#+begin_src shell
# Port-forward the service
kubectl port-forward pod/<POD_NAME> 3000:80 
xh localhost:3000/health

# OR check from inside of the container
kubectl exec -it <POD_NAME> -- netstat -tlnp           # to sanity-check which port the service is running on
kubectl exec -it <POD_NAME> -- wget -qO- http://localhost:3000/health

# Expected output: {"status":"ok"}
#+end_src

